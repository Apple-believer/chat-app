</html>
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>Chat App</title>
    <style>
        #output {
            height: 80vh;
            background: #8DB4E5;
            overflow: scroll;
            width: 60%;
            margin: 30px auto;
        }

        .msg:nth-child(odd) {
            width: 40%;
            background: white;
            box-sizing: 10px;

            padding: 10px;
            margin: 10 auto;
            box: sizing 100px;


        }

        .msg:nth-child(even) {
            background: white;
            width: 40%;
            padding: 10px;

            margin: 0 auto;
        }

        .text {
            height: 10vh;
            display: flex;
        }

        section {
            width: 60%;
            margin: 0 auto;
        }

        .text {
            width: 100%;
            height: 100%;
            resize: none;
            /* ã“ã‚Œã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚µã‚¤ã‚ºã‚’ã§ããªãã™ã‚‹ */
            border: 1px solid #ddd;
            /* æ ç·šã‚’ã¤ã‘ã¦é ˜åŸŸã‚’åˆ†ã‹ã‚Šã‚„ã™ã */
            box-sizing: border-box;
        }
    </style>

</head>

<body>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div id="output"><div id="date"></div></div>
    <section>

        <!-- <div> åå‰ï¼š<input type="text" id="uname"> </div> -->
        <textarea id="text" style="width: 100%;
            height: 10%;
            resize: none; 
            border: 1px solid #ddd; 
            box-sizing: border-box; "></textarea>
        <button id="send" style="width: 100%;
            height: 10%;
            background: #61E739;
            color: #fff;
            font-size: 2.0rem;
            font-weight: bold;
            border: 0;">é€ä¿¡</button>
    </section>
    <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";

        // è²¼ã‚Šä»˜ã‘ã‚‹å ´æ‰€
        import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
        // 


        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);




        const db = getDatabase(app);
        const dbRef = ref(db, 'dev245');

        // é€ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        $('#send').on('click', function () {

            var nowTime = $.now();
	$("body").append("<br/>" + nowTime);
            const text = $('#text').val();
            const messageText = $('#text').val()
            // ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ã®è¦ç´ ã‚’å–å¾—
            const chatArea = $('.chat-area')

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹divè¦ç´ 
            const messageContainer = $('<div></div>')

            // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®è£…é£¾ã‚’ã—ãŸã‚¯ãƒ©ã‚¹ã‚’å½“ã¦ãŸpã‚¿ã‚°ã‚’è¿½åŠ 
            const message = $('<p></p>').addClass('chat-message').text(messageText)


            chatArea.append(messageContainer)


            const msg = {

                text: text,
            }


            const newPostRef = push(dbRef) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
            set(newPostRef, msg); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—


            $('#text').val("");


        });


        $("#text").on('keydown', function (e) {
            console.log(e, 'ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            console.log(e.keyCode, 'ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã®å¡Š')

        });

        // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        onChildAdded(dbRef, function (data) {

            const msg = data.val();
            console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            const key = data.key;
            console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')



            let h = `
                <div class="msg">
                    <p>${msg.text}</p>
                </div>    
            `;

            $("#output").append(h);
            const output = document.getElementById('output');
            output.scrollTo(0, output.scrollHeight);
        })





    </script>










</body>

</html>